<!DOCTYPE html>
<html lang=zh>
<head>
    <meta charset="utf-8">
    
    <title>李明梓个人空间</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta property="og:type" content="website">
<meta property="og:title" content="李明梓个人空间">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="李明梓个人空间">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="李明梓个人空间">
    

    
        <link rel="alternate" href="/" title="李明梓个人空间" type="application/atom+xml" />
    

    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    
    


</head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">李明梓个人空间</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">Home</a>
                
                    <a class="main-nav-link" href="/archives">Archives</a>
                
                    <a class="main-nav-link" href="/categories">Categories</a>
                
                    <a class="main-nav-link" href="/tags">Tags</a>
                
                    <a class="main-nav-link" href="/about">About</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/css/images/favicon.gif" />
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="想要查找什么..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">Home</a></td>
                
                    <td><a class="main-nav-link" href="/archives">Archives</a></td>
                
                    <td><a class="main-nav-link" href="/categories">Categories</a></td>
                
                    <td><a class="main-nav-link" href="/tags">Tags</a></td>
                
                    <td><a class="main-nav-link" href="/about">About</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="/css/images/favicon.gif" />
            <h2 id="name">mingzi li</h2>
            <h3 id="title">Web Developer &amp; Designer</h3>
            <span id="location"><i class="fa fa-map-marker"></i>xiamen, China</span>
            <a id="follow" target="_blank" href="https://qiaomingzi.github.io">关注我</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                5
                <span>文章</span>
            </div>
            <div class="article-info-block">
                2
                <span>标签</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        <a href="http://github.com/qiaomingzi" target="_blank" title="github" class=tooltip>
                            <i class="fa fa-github"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="twitter" class=tooltip>
                            <i class="fa fa-twitter"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="facebook" class=tooltip>
                            <i class="fa fa-facebook"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="dribbble" class=tooltip>
                            <i class="fa fa-dribbble"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="rss" class=tooltip>
                            <i class="fa fa-rss"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            <section id="main">
    <article id="post-正则表达式30分钟入门教程" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/doc/2017-09-28/正则表达式30分钟入门教程/">正则表达式30分钟入门教程</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/doc/2017-09-28/正则表达式30分钟入门教程/">
            <time datetime="2017-09-28T07:42:33.000Z" itemprop="datePublished">2017-09-28</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/软文收集/">软文收集</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><p><a href="#mission">跳过目录</a></p>
<ol>
<li><a href="#mission">本文目标</a></li>
<li><a href="#howtouse">如何使用本教程</a></li>
<li><a href="#introduction">正则表达式到底是什么东西？</a></li>
<li><a href="#getstarted">入门</a></li>
<li><a href="#testing">测试正则表达式</a></li>
<li><a href="#metacode">元字符</a></li>
<li><a href="#escape">字符转义</a></li>
<li><a href="#repeat">重复</a></li>
<li><a href="#charclass">字符类</a></li>
<li><a href="#alternative">分枝条件</a></li>
<li><a href="#negation">反义</a></li>
<li><a href="#grouping">分组</a></li>
<li><a href="#backreference">后向引用</a></li>
<li><a href="#lookaround">零宽断言</a></li>
<li><a href="#negativelookaround">负向零宽断言</a></li>
<li><a href="#commenting">注释</a></li>
<li><a href="#greedyandlazy">贪婪与懒惰</a></li>
<li><a href="#regexoptions">处理选项</a></li>
<li><a href="#balancedgroup">平衡组/递归匹配</a></li>
<li><a href="#more">还有些什么东西没提到</a></li>
<li><a href="#contact">联系作者</a></li>
<li><a href="#resources">网上的资源及本文参考文献</a></li>
<li><a href="#updatelog">更新纪录</a></li>
</ol>
<h2 id="本文目标"><a href="#本文目标" class="headerlink" title="本文目标"></a>本文目标</h2><p>30分钟内让你明白正则表达式是什么，并对它有一些基本的了解，让你可以在自己的程序或网页里使用它。</p>
<h2 id="如何使用本教程"><a href="#如何使用本教程" class="headerlink" title="如何使用本教程"></a>如何使用本教程</h2><p>最重要的是——请给我<em>30分钟</em>，如果你没有使用正则表达式的经验，请不要试图在30<em>秒</em>内入门——除非你是超人 :)</p>
<p>别被下面那些复杂的表达式吓倒，只要跟着我一步一步来，你会发现正则表达式其实并没有你想像中的那么困难。当然，如果你看完了这篇教程之后，发现自己明白了很多，却又几乎什么都记不得，那也是很正常的——我认为，没接触过正则表达式的人在看完这篇教程后，能把提到过的语法记住80%以上的可能性为零。这里只是让你明白基本的原理，以后你还需要多练习，多使用，才能熟练掌握正则表达式。</p>
<p>除了作为入门教程之外，本文还试图成为可以在日常工作中使用的正则表达式语法参考手册。就作者本人的经历来说，这个目标还是完成得不错的——你看，我自己也没能把所有的东西记下来，不是吗？</p>
<p><a href="http://deerchao.net/tutorials/regex/regex.htm" target="_blank" rel="external">清除格式</a> 文本格式约定：专业术语 元字符/语法格式 正则表达式 正则表达式中的一部分(用于分析) 对其进行匹配的源字符串 对正则表达式或其中一部分的说明</p>
<p><a href="http://deerchao.net/tutorials/regex/regex.htm" target="_blank" rel="external">隐藏边注</a> 本文右边有一些注释，主要是用来提供一些相关信息，或者给没有程序员背景的读者解释一些基本概念，通常可以忽略。</p>
<h2 id="正则表达式到底是什么东西？"><a href="#正则表达式到底是什么东西？" class="headerlink" title="正则表达式到底是什么东西？"></a>正则表达式到底是什么东西？</h2><p>字符是计算机软件处理文字时最基本的单位，可能是字母，数字，标点符号，空格，换行符，汉字等等。字符串是0个或更多个字符的序列。文本也就是文字，字符串。说某个字符串匹配某个正则表达式，通常是指这个字符串里有一部分（或几部分分别）能满足表达式给出的条件。</p>
<p>在编写处理字符串的程序或网页时，经常会有查找符合某些复杂规则的字符串的需要。正则表达式就是用于描述这些规则的工具。换句话说，正则表达式就是记录文本规则的代码。</p>
<p>很可能你使用过Windows/Dos下用于文件查找的通配符(wildcard)，也就是<em>和?。如果你想查找某个目录下的所有的Word文档的话，你会搜索</em>.doc。在这里，*会被解释成任意的字符串。和通配符类似，正则表达式也是用来进行文本匹配的工具，只不过比起通配符，它能更精确地描述你的需求——当然，代价就是更复杂——比如你可以编写一个正则表达式，用来查找所有以0开头，后面跟着2-3个数字，然后是一个连字号“-”，最后是7或8位数字的字符串(像010-12345678或0376-7654321)。</p>
<h2 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门</h2><p>学习正则表达式的最好方法是从例子开始，理解例子之后再自己对例子进行修改，实验。下面给出了不少简单的例子，并对它们作了详细的说明。</p>
<p>假设你在一篇英文小说里查找hi，你可以使用正则表达式hi。</p>
<p>这几乎是最简单的正则表达式了，它可以精确匹配这样的字符串：由两个字符组成，前一个字符是h,后一个是i。通常，处理正则表达式的工具会提供一个忽略大小写的选项，如果选中了这个选项，它可以匹配hi,HI,Hi,hI这四种情况中的任意一种。</p>
<p>不幸的是，很多单词里包含hi这两个连续的字符，比如him,history,high等等。用hi来查找的话，这里边的hi也会被找出来。如果要精确地查找hi这个单词的话，我们应该使用\bhi\b。</p>
<p>\b是正则表达式规定的一个特殊代码（好吧，某些人叫它元字符，metacharacter），代表着单词的开头或结尾，也就是单词的分界处。虽然通常英文的单词是由空格，标点符号或者换行来分隔的，但是\b并不匹配这些单词分隔字符中的任何一个，它<strong>只匹配一个位置</strong>。</p>
<p>如果需要更精确的说法，\b匹配这样的位置：它的前一个字符和后一个字符不全是(一个是,一个不是或不存在)\w。</p>
<p>假如你要找的是hi后面不远处跟着一个Lucy，你应该用\bhi\b.*\bLucy\b。</p>
<p>这里，.是另一个元字符，匹配除了换行符以外的任意字符。<em>同样是元字符，不过它代表的不是字符，也不是位置，而是数量——它指定</em>前边的内容可以连续重复使用任意次以使整个表达式得到匹配。因此，.<em>连在一起就意味着任意数量的不包含换行的字符。现在\bhi\b.</em>\bLucy\b的意思就很明显了：先是一个单词hi,然后是任意个任意字符(但不能是换行)，最后是Lucy这个单词。</p>
<p>换行符就是’\n’,ASCII编码为10(十六进制0x0A)的字符。</p>
<p>如果同时使用其它元字符，我们就能构造出功能更强大的正则表达式。比如下面这个例子：</p>
<p>0\d\d-\d\d\d\d\d\d\d\d匹配这样的字符串：以0开头，然后是两个数字，然后是一个连字号“-”，最后是8个数字(也就是中国的电话号码。当然，这个例子只能匹配区号为3位的情形)。</p>
<p>这里的\d是个新的元字符，匹配一位数字(0，或1，或2，或……)。-不是元字符，只匹配它本身——连字符(或者减号，或者中横线，或者随你怎么称呼它)。</p>
<p>为了避免那么多烦人的重复，我们也可以这样写这个表达式：0\d{2}-\d{8}。 这里\d后面的{2}({8})的意思是前面\d必须连续重复匹配2次(8次)。</p>
<h2 id="测试正则表达式"><a href="#测试正则表达式" class="headerlink" title="测试正则表达式"></a>测试正则表达式</h2><p>其它可用的测试工具:</p>
<ul>
<li><a href="http://www.regexbuddy.com/" target="_blank" rel="external">RegexBuddy</a></li>
<li><a href="http://regexpal.com/" target="_blank" rel="external">Javascript正则表达式在线测试工具</a></li>
</ul>
<p>如果你不觉得正则表达式很难读写的话，要么你是一个天才，要么，你不是地球人。正则表达式的语法很令人头疼，即使对经常使用它的人来说也是如此。由于难于读写，容易出错，所以找一种工具对正则表达式进行测试是很有必要的。</p>
<p>不同的环境下正则表达式的一些细节是不相同的，本教程介绍的是微软 .Net Framework 4.0 下正则表达式的行为，所以，我向你推荐我编写的.Net下的工具 <a href="http://deerchao.net/tools/regex_tester/index.htm" target="_blank" rel="external">正则表达式测试器</a>。请参考该页面的说明来安装和运行该软件。</p>
<p>下面是Regex Tester运行时的截图：</p>
<h2 id="元字符"><a href="#元字符" class="headerlink" title="元字符"></a>元字符</h2><p>现在你已经知道几个很有用的元字符了，如\b,.,*，还有\d.正则表达式里还有更多的元字符，比如\s匹配任意的空白符，包括空格，制表符(Tab)，换行符，中文全角空格等。\w匹配字母或数字或下划线或汉字等。</p>
<p>对中文/汉字的特殊处理是由.Net提供的正则表达式引擎支持的，其它环境下的具体情况请查看相关文档。</p>
<p>下面来看看更多的例子：</p>
<p>\ba\w<em>\b匹配以字母a开头的单词——先是某个单词开始处(\b)，然后是字母a,然后是任意数量的字母或数字(\w</em>)，最后是单词结束处(\b)。</p>
<p>好吧，现在我们说说正则表达式里的单词是什么意思吧：就是不少于一个的连续的\w。不错，这与学习英文时要背的成千上万个同名的东西的确关系不大 :)</p>
<p>\d+匹配1个或更多连续的数字。这里的+是和<em>类似的元字符，不同的是</em>匹配重复任意次(可能是0次)，而+则匹配重复1次或更多次。</p>
<p>\b\w{6}\b 匹配刚好6个字符的单词。</p>
<table>
<thead>
<tr>
<th>代码</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>.</td>
<td>匹配除换行符以外的任意字符</td>
</tr>
<tr>
<td>\w</td>
<td>匹配字母或数字或下划线或汉字</td>
</tr>
<tr>
<td>\s</td>
<td>匹配任意的空白符</td>
</tr>
<tr>
<td>\d</td>
<td>匹配数字</td>
</tr>
<tr>
<td>\b</td>
<td>匹配单词的开始或结束</td>
</tr>
<tr>
<td>^</td>
<td>匹配字符串的开始</td>
</tr>
<tr>
<td>$</td>
<td>匹配字符串的结束</td>
</tr>
</tbody>
</table>
<p>正则表达式引擎通常会提供一个“测试指定的字符串是否匹配一个正则表达式”的方法，如JavaScript里的RegExp.test()方法或.NET里的Regex.IsMatch()方法。这里的匹配是指是字符串里有没有符合表达式规则的部分。如果不使用^和$的话，对于\d{5,12}而言，使用这样的方法就只能保证字符串里包含5到12连续位数字，而不是整个字符串就是5到12位数字。</p>
<p>元字符^（和数字6在同一个键位上的符号）和$都匹配一个位置，这和\b有点类似。^匹配你要用来查找的字符串的开头，$匹配结尾。这两个代码在验证输入的内容时非常有用，比如一个网站如果要求你填写的QQ号必须为5位到12位数字时，可以使用：^\d{5,12}$。</p>
<p>这里的{5,12}和前面介绍过的{2}是类似的，只不过{2}匹配只能不多不少重复2次，{5,12}则是重复的次数不能少于5次，不能多于12次，否则都不匹配。</p>
<p>因为使用了^和$，所以输入的整个字符串都要用来和\d{5,12}来匹配，也就是说整个输入必须是5到12个数字，因此如果输入的QQ号能匹配这个正则表达式的话，那就符合要求了。</p>
<p>和忽略大小写的选项类似，有些正则表达式处理工具还有一个处理多行的选项。如果选中了这个选项，^和$的意义就变成了匹配行的开始处和结束处。</p>
<h2 id="字符转义"><a href="#字符转义" class="headerlink" title="字符转义"></a>字符转义</h2><p>如果你想查找元字符本身的话，比如你查找.,或者<em>,就出现了问题：你没办法指定它们，因为它们会被解释成别的意思。这时你就得使用\来取消这些字符的特殊意义。因此，你应该使用.和\</em>。当然，要查找\本身，你也得用\.</p>
<p>例如：unibetter.com匹配unibetter.com，C:\Windows匹配C:\Windows。</p>
<h2 id="重复"><a href="#重复" class="headerlink" title="重复"></a>重复</h2><p>你已经看过了前面的<em>,+,{2},{5,12}这几个匹配重复的方式了。下面是正则表达式中所有的限定符(指定数量的代码，例如</em>,{5,12}等)：</p>
<table>
<thead>
<tr>
<th>代码/语法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>*</td>
<td>重复零次或更多次</td>
</tr>
<tr>
<td>+</td>
<td>重复一次或更多次</td>
</tr>
<tr>
<td>?</td>
<td>重复零次或一次</td>
</tr>
<tr>
<td>{n}</td>
<td>重复n次</td>
</tr>
<tr>
<td>{n,}</td>
<td>重复n次或更多次</td>
</tr>
<tr>
<td>{n,m}</td>
<td>重复n到m次</td>
</tr>
</tbody>
</table>
<p>下面是一些使用重复的例子：</p>
<p>Windows\d+匹配Windows后面跟1个或更多数字</p>
<p>^\w+匹配一行的第一个单词(或整个字符串的第一个单词，具体匹配哪个意思得看选项设置)</p>
<h2 id="字符类"><a href="#字符类" class="headerlink" title="字符类"></a>字符类</h2><p>要想查找数字，字母或数字，空白是很简单的，因为已经有了对应这些字符集合的元字符，但是如果你想匹配没有预定义元字符的字符集合(比如元音字母a,e,i,o,u),应该怎么办？</p>
<p>很简单，你只需要在方括号里列出它们就行了，像[aeiou]就匹配任何一个英文元音字母，[.?!]匹配标点符号(.或?或!)。</p>
<p>我们也可以轻松地指定一个字符范围，像[0-9]代表的含意与\d就是完全一致的：一位数字；同理[a-z0-9A-Z_]也完全等同于\w（如果只考虑英文的话）。</p>
<p>下面是一个更复杂的表达式：(?0\d{2}[) -]?\d{8}。</p>
<p>“(”和“)”也是元字符，后面的<a href="#grouping">分组节</a>里会提到，所以在这里需要使用<a href="#escape">转义</a>。</p>
<p>这个表达式可以匹配几种格式的电话号码，像(010)88886666，或022-22334455，或02912345678等。我们对它进行一些分析吧：首先是一个转义字符(,它能出现0次或1次(?),然后是一个0，后面跟着2个数字(\d{2})，然后是)或-或空格中的一个，它出现1次或不出现(?)，最后是8个数字(\d{8})。</p>
<h2 id="分枝条件"><a href="#分枝条件" class="headerlink" title="分枝条件"></a>分枝条件</h2><p>不幸的是，刚才那个表达式也能匹配010)12345678或(022-87654321这样的“不正确”的格式。要解决这个问题，我们需要用到分枝条件。正则表达式里的分枝条件指的是有几种规则，如果满足其中任意一种规则都应该当成匹配，具体方法是用|把不同的规则分隔开。听不明白？没关系，看例子：</p>
<p>0\d{2}-\d{8}|0\d{3}-\d{7}这个表达式能匹配两种以连字号分隔的电话号码：一种是三位区号，8位本地号(如010-12345678)，一种是4位区号，7位本地号(0376-2233445)。</p>
<p>(0\d{2})[- ]?\d{8}|0\d{2}[- ]?\d{8}这个表达式匹配3位区号的电话号码，其中区号可以用小括号括起来，也可以不用，区号与本地号间可以用连字号或空格间隔，也可以没有间隔。你可以试试用分枝条件把这个表达式扩展成也支持4位区号的。</p>
<p>\d{5}-\d{4}|\d{5}这个表达式用于匹配美国的邮政编码。美国邮编的规则是5位数字，或者用连字号间隔的9位数字。之所以要给出这个例子是因为它能说明一个问题：<strong>使用分枝条件时，要注意各个条件的顺序</strong>。如果你把它改成\d{5}|\d{5}-\d{4}的话，那么就只会匹配5位的邮编(以及9位邮编的前5位)。原因是匹配分枝条件时，将会从左到右地测试每个条件，如果满足了某个分枝的话，就不会去再管其它的条件了。</p>
<h2 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h2><p>我们已经提到了怎么重复单个字符（直接在字符后面加上限定符就行了）；但如果想要重复多个字符又该怎么办？你可以用小括号来指定子表达式(也叫做分组)，然后你就可以指定这个子表达式的重复次数了，你也可以对子表达式进行其它一些操作(后面会有介绍)。</p>
<p>(\d{1,3}.){3}\d{1,3}是一个简单的IP地址匹配表达式。要理解这个表达式，请按下列顺序分析它：\d{1,3}匹配1到3位的数字，(\d{1,3}.){3}匹配三位数字加上一个英文句号(这个整体也就是这个分组)重复3次，最后再加上一个一到三位的数字(\d{1,3})。</p>
<p>IP地址中每个数字都不能大于255，大家千万不要被《24》第三季的编剧给忽悠了……</p>
<p>不幸的是，它也将匹配256.300.888.999这种不可能存在的IP地址。如果能使用算术比较的话，或许能简单地解决这个问题，但是正则表达式中并不提供关于数学的任何功能，所以只能使用冗长的分组，选择，字符类来描述一个正确的IP地址：((2[0-4]\d|25[0-5]|[01]?\d\d?).){3}(2[0-4]\d|25[0-5]|[01]?\d\d?)。</p>
<p>理解这个表达式的关键是理解2[0-4]\d|25[0-5]|[01]?\d\d?，这里我就不细说了，你自己应该能分析得出来它的意义。</p>
<h2 id="反义"><a href="#反义" class="headerlink" title="反义"></a>反义</h2><p>有时需要查找不属于某个能简单定义的字符类的字符。比如想查找除了数字以外，其它任意字符都行的情况，这时需要用到反义：</p>
<table>
<thead>
<tr>
<th>代码/语法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>\W</td>
<td>匹配任意不是字母，数字，下划线，汉字的字符</td>
</tr>
<tr>
<td>\S</td>
<td>匹配任意不是空白符的字符</td>
</tr>
<tr>
<td>\D</td>
<td>匹配任意非数字的字符</td>
</tr>
<tr>
<td>\B</td>
<td>匹配不是单词开头或结束的位置</td>
</tr>
<tr>
<td>[^x]</td>
<td>匹配除了x以外的任意字符</td>
</tr>
<tr>
<td>[^aeiou]</td>
<td>匹配除了aeiou这几个字母以外的任意字符</td>
</tr>
</tbody>
</table>
<p>例子：\S+匹配不包含空白符的字符串。</p>
<p><a[^>]+&gt;匹配用尖括号括起来的以a开头的字符串。</a[^></p>
<h2 id="后向引用"><a href="#后向引用" class="headerlink" title="后向引用"></a>后向引用</h2><p>使用小括号指定一个子表达式后，<strong>匹配这个子表达式的文本</strong>(也就是此分组捕获的内容)可以在表达式或其它程序中作进一步的处理。默认情况下，每个分组会自动拥有一个组号，规则是：从左向右，以分组的左括号为标志，第一个出现的分组的组号为1，第二个为2，以此类推。</p>
<p>呃……其实,组号分配还不像我刚说得那么简单：</p>
<ul>
<li>分组0对应整个正则表达式</li>
<li>实际上组号分配过程是要从左向右扫描两遍的：第一遍只给未命名组分配，第二遍只给命名组分配－－因此所有命名组的组号都大于未命名的组号</li>
<li>你可以使用(?:exp)这样的语法来剥夺一个分组对组号分配的参与权．</li>
</ul>
<p>后向引用用于重复搜索前面某个分组匹配的文本。例如，\1代表分组1匹配的文本。难以理解？请看示例：</p>
<p>\b(\w+)\b\s+\1\b可以用来匹配重复的单词，像go go, 或者kitty kitty。这个表达式首先是一个单词，也就是单词开始处和结束处之间的多于一个的字母或数字(\b(\w+)\b)，这个单词会被捕获到编号为1的分组中，然后是1个或几个空白符(\s+)，最后是分组1中捕获的内容（也就是前面匹配的那个单词）(\1)。</p>
<p>你也可以自己指定子表达式的组名。要指定一个子表达式的组名，请使用这样的语法：(?<word>\w+)(或者把尖括号换成’也行：(?’Word’\w+)),这样就把\w+的组名指定为Word了。要反向引用这个分组捕获的内容，你可以使用\k<word>,所以上一个例子也可以写成这样：\b(?<word>\w+)\b\s+\k<word>\b。</word></word></word></word></p>
<p>使用小括号的时候，还有很多特定用途的语法。下面列出了最常用的一些：</p>
<table>
<thead>
<tr>
<th>分类</th>
<th>代码/语法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>捕获</td>
<td>(exp)</td>
<td>匹配exp,并捕获文本到自动命名的组里</td>
</tr>
<tr>
<td>(?<name>exp)</name></td>
<td>匹配exp,并捕获文本到名称为name的组里，也可以写成(?’name’exp)</td>
<td></td>
</tr>
<tr>
<td>(?:exp)</td>
<td>匹配exp,不捕获匹配的文本，也不给此分组分配组号</td>
<td></td>
</tr>
<tr>
<td>零宽断言</td>
<td>(?=exp)</td>
<td>匹配exp前面的位置</td>
</tr>
<tr>
<td>(?&lt;=exp)</td>
<td>匹配exp后面的位置</td>
<td></td>
</tr>
<tr>
<td>(?!exp)</td>
<td>匹配后面跟的不是exp的位置</td>
<td></td>
</tr>
<tr>
<td>(?&lt;!exp)</td>
<td>匹配前面不是exp的位置</td>
<td></td>
</tr>
<tr>
<td>注释</td>
<td>(?#comment)</td>
<td>这种类型的分组不对正则表达式的处理产生任何影响，用于提供注释让人阅读</td>
</tr>
</tbody>
</table>
<p>我们已经讨论了前两种语法。第三个(?:exp)不会改变正则表达式的处理方式，只是这样的组匹配的内容不会像前两种那样被捕获到某个组里面，也不会拥有组号。“我为什么会想要这样做？”——好问题，你觉得为什么呢？</p>
<h2 id="零宽断言"><a href="#零宽断言" class="headerlink" title="零宽断言"></a>零宽断言</h2><p>地球人，是不是觉得这些术语名称太复杂，太难记了？我也有同感。知道有这么一种东西就行了，它叫什么，随它去吧！人若无名，便可专心练剑；物若无名，便可随意取舍……</p>
<p>接下来的四个用于查找在某些内容(但并不包括这些内容)之前或之后的东西，也就是说它们像\b,^,$那样用于指定一个位置，这个位置应该满足一定的条件(即断言)，因此它们也被称为零宽断言。最好还是拿例子来说明吧：</p>
<p>断言用来声明一个应该为真的事实。正则表达式中只有当断言为真时才会继续进行匹配。</p>
<p>(?=exp)也叫零宽度正预测先行断言，它断言自身出现的位置的后面能匹配表达式exp。比如\b\w+(?=ing\b)，匹配以ing结尾的单词的前面部分(除了ing以外的部分)，如查找I’m singing while you’re dancing.时，它会匹配sing和danc。</p>
<p>(?&lt;=exp)也叫零宽度正回顾后发断言，它断言自身出现的位置的前面能匹配表达式exp。比如(?&lt;=\bre)\w+\b会匹配以re开头的单词的后半部分(除了re以外的部分)，例如在查找reading a book时，它匹配ading。</p>
<p>假如你想要给一个很长的数字中每三位间加一个逗号(当然是从右边加起了)，你可以这样查找需要在前面和里面添加逗号的部分：((?&lt;=\d)\d{3})+\b，用它对1234567890进行查找时结果是234567890。</p>
<p>下面这个例子同时使用了这两种断言：(?&lt;=\s)\d+(?=\s)匹配以空白符间隔的数字(再次强调，不包括这些空白符)。</p>
<h2 id="负向零宽断言"><a href="#负向零宽断言" class="headerlink" title="负向零宽断言"></a>负向零宽断言</h2><p>前面我们提到过怎么查找<strong>不是某个字符或不在某个字符类里</strong>的字符的方法(反义)。但是如果我们只是想要<strong>确保某个字符没有出现，但并不想去匹配它</strong>时怎么办？例如，如果我们想查找这样的单词–它里面出现了字母q,但是q后面跟的不是字母u,我们可以尝试这样：</p>
<p>\b\w<em>q[^u]\w</em>\b匹配包含<strong>后面不是字母u的字母q</strong>的单词。但是如果多做测试(或者你思维足够敏锐，直接就观察出来了)，你会发现，如果q出现在单词的结尾的话，像<strong>Iraq</strong>,<strong>Benq</strong>，这个表达式就会出错。这是因为[^u]总要匹配一个字符，所以如果q是单词的最后一个字符的话，后面的[^u]将会匹配q后面的单词分隔符(可能是空格，或者是句号或其它的什么)，后面的\w<em>\b将会匹配下一个单词，于是\b\w</em>q[^u]\w<em>\b就能匹配整个Iraq fighting。负向零宽断言能解决这样的问题，因为它只匹配一个位置，并不<strong>消费</strong>任何字符。现在，我们可以这样来解决这个问题：\b\w</em>q(?!u)\w*\b。</p>
<p>零宽度负预测先行断言(?!exp)，断言此位置的后面不能匹配表达式exp。例如：\d{3}(?!\d)匹配三位数字，而且这三位数字的后面不能是数字；\b((?!abc)\w)+\b匹配不包含连续字符串abc的单词。</p>
<p>同理，我们可以用(?&lt;!exp),零宽度负回顾后发断言来断言此位置的前面不能匹配表达式exp：(?&lt;![a-z])\d{7}匹配前面不是小写字母的七位数字。</p>
<p>请详细分析表达式(?&lt;=&lt;(\w+)&gt;).*(?=&lt;\/\1&gt;)，这个表达式最能表现零宽断言的真正用途。</p>
<p>一个更复杂的例子：(?&lt;=&lt;(\w+)&gt;).<em>(?=&lt;\/\1&gt;)匹配不包含属性的简单HTML标签内里的内容。(?&lt;=&lt;(\w+)&gt;)指定了这样的前缀：被尖括号括起来的单词(比如可能是<b>)，然后是.</b></em>(任意的字符串),最后是一个后缀(?=&lt;\/\1&gt;)。注意后缀里的\/，它用到了前面提过的字符转义；\1则是一个反向引用，引用的正是捕获的第一组，前面的(\w+)匹配的内容，这样如果前缀实际上是<b>的话，后缀就是</b>了。整个表达式匹配的是<b>和</b>之间的内容(再次提醒，不包括前缀和后缀本身)。</p>
<h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h2><p>小括号的另一种用途是通过语法(?#comment)来包含注释。例如：2[0-4]\d(?#200-249)|25<a href="?#250-255">0-5</a>|[01]?\d\d?(?#0-199)。</p>
<p>要包含注释的话，最好是启用“忽略模式里的空白符”选项，这样在编写表达式时能任意的添加空格，Tab，换行，而实际使用时这些都将被忽略。启用这个选项后，在#后面到这一行结束的所有文本都将被当成注释忽略掉。例如，我们可以前面的一个表达式写成这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">(?&lt;=    # 断言要匹配的文本的前缀</div><div class="line">&lt;(\w+)&gt; # 查找尖括号括起来的字母或数字(即HTML/XML标签)</div><div class="line">)       # 前缀结束</div><div class="line">.*      # 匹配任意文本</div><div class="line">(?=     # 断言要匹配的文本的后缀</div><div class="line">&lt;\/\1&gt;  # 查找尖括号括起来的内容：前面是一个&quot;/&quot;，后面是先前捕获的标签</div><div class="line">)       # 后缀结束</div></pre></td></tr></table></figure>
<h2 id="贪婪与懒惰"><a href="#贪婪与懒惰" class="headerlink" title="贪婪与懒惰"></a>贪婪与懒惰</h2><p>当正则表达式中包含能接受重复的限定符时，通常的行为是（在使整个表达式能得到匹配的前提下）匹配<strong>尽可能多</strong>的字符。以这个表达式为例：a.*b，它将会匹配最长的以a开始，以b结束的字符串。如果用它来搜索aabab的话，它会匹配整个字符串aabab。这被称为贪婪匹配。</p>
<p>有时，我们更需要懒惰匹配，也就是匹配<strong>尽可能少</strong>的字符。前面给出的限定符都可以被转化为懒惰匹配模式，只要在它后面加上一个问号?。这样.*?就意味着匹配任意数量的重复，但是在能使整个匹配成功的前提下使用最少的重复。现在看看懒惰版的例子吧：</p>
<p>a.*?b匹配最短的，以a开始，以b结束的字符串。如果把它应用于aabab的话，它会匹配aab（第一到第三个字符）和ab（第四到第五个字符）。</p>
<p>为什么第一个匹配是aab（第一到第三个字符）而不是ab（第二到第三个字符）？简单地说，因为正则表达式有另一条规则，比懒惰／贪婪规则的优先级更高：最先开始的匹配拥有最高的优先权——The match that begins earliest wins。</p>
<table>
<thead>
<tr>
<th>代码/语法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>*?</td>
<td>重复任意次，但尽可能少重复</td>
</tr>
<tr>
<td>+?</td>
<td>重复1次或更多次，但尽可能少重复</td>
</tr>
<tr>
<td>??</td>
<td>重复0次或1次，但尽可能少重复</td>
</tr>
<tr>
<td>{n,m}?</td>
<td>重复n到m次，但尽可能少重复</td>
</tr>
<tr>
<td>{n,}?</td>
<td>重复n次以上，但尽可能少重复</td>
</tr>
</tbody>
</table>
<h2 id="处理选项"><a href="#处理选项" class="headerlink" title="处理选项"></a>处理选项</h2><p>在C#中，你可以使用<a href="http://msdn2.microsoft.com/zh-cn/library/h5845fdz.aspx" target="_blank" rel="external">Regex(String, RegexOptions)构造函数</a>来设置正则表达式的处理选项。如：Regex regex = new Regex(@”\ba\w{6}\b”, RegexOptions.IgnoreCase);</p>
<p>上面介绍了几个选项如忽略大小写，处理多行等，这些选项能用来改变处理正则表达式的方式。下面是.Net中常用的正则表达式选项：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>IgnoreCase(忽略大小写)</td>
<td>匹配时不区分大小写。</td>
</tr>
<tr>
<td>Multiline(多行模式)</td>
<td>更改^和$的含义，使它们分别在任意一行的行首和行尾匹配，而不仅仅在整个字符串的开头和结尾匹配。(在此模式下,$的精确含意是:匹配\n之前的位置以及字符串结束前的位置.)</td>
</tr>
<tr>
<td>Singleline(单行模式)</td>
<td>更改.的含义，使它与每一个字符匹配（包括换行符\n）。</td>
</tr>
<tr>
<td>IgnorePatternWhitespace(忽略空白)</td>
<td>忽略表达式中的非转义空白并启用由#标记的注释。</td>
</tr>
<tr>
<td>ExplicitCapture(显式捕获)</td>
<td>仅捕获已被显式命名的组。</td>
</tr>
</tbody>
</table>
<p>一个经常被问到的问题是：是不是只能同时使用多行模式和单行模式中的一种？答案是：不是。这两个选项之间没有任何关系，除了它们的名字比较相似（以至于让人感到疑惑）以外。</p>
<h2 id="平衡组-递归匹配"><a href="#平衡组-递归匹配" class="headerlink" title="平衡组/递归匹配"></a>平衡组/递归匹配</h2><p>这里介绍的平衡组语法是由.Net Framework支持的；其它语言／库不一定支持这种功能，或者支持此功能但需要使用不同的语法。</p>
<p>有时我们需要匹配像( 100 * ( 50 + 15 ) )这样的可嵌套的层次性结构，这时简单地使用(.+)则只会匹配到最左边的左括号和最右边的右括号之间的内容(这里我们讨论的是贪婪模式，懒惰模式也有下面的问题)。假如原来的字符串里的左括号和右括号出现的次数不相等，比如( 5 / ( 3 + 2 ) ) )，那我们的匹配结果里两者的个数也不会相等。有没有办法在这样的字符串里匹配到最长的，配对的括号之间的内容呢？</p>
<p>为了避免(和(把你的大脑彻底搞糊涂，我们还是用尖括号代替圆括号吧。现在我们的问题变成了如何把xx <aa <bbb=""> <bbb> aa&gt; yy这样的字符串里，最长的配对的尖括号内的内容捕获出来？</bbb></aa></p>
<p>这里需要用到以下的语法构造：</p>
<ul>
<li>(?’group’) 把捕获的内容命名为group,并压入堆栈(Stack)</li>
<li>(?’-group’) 从堆栈上弹出最后压入堆栈的名为group的捕获内容，如果堆栈本来为空，则本分组的匹配失败</li>
<li>(?(group)yes|no) 如果堆栈上存在以名为group的捕获内容的话，继续匹配yes部分的表达式，否则继续匹配no部分</li>
<li>(?!) 零宽负向先行断言，由于没有后缀表达式，试图匹配总是失败</li>
</ul>
<p>如果你不是一个程序员（或者你自称程序员但是不知道堆栈是什么东西），你就这样理解上面的三种语法吧：第一个就是在黑板上写一个”group”，第二个就是从黑板上擦掉一个”group”，第三个就是看黑板上写的还有没有”group”，如果有就继续匹配yes部分，否则就匹配no部分。</p>
<p>我们需要做的是每碰到了左括号，就在压入一个”Open”,每碰到一个右括号，就弹出一个，到了最后就看看堆栈是否为空－－如果不为空那就证明左括号比右括号多，那匹配就应该失败。正则表达式引擎会进行回溯(放弃最前面或最后面的一些字符)，尽量使整个表达式得到匹配。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&lt;                         #最外层的左括号</div><div class="line">    [^&lt;&gt;]*                #最外层的左括号后面的不是括号的内容</div><div class="line">    (</div><div class="line">        (</div><div class="line">            (?&apos;Open&apos;&lt;)    #碰到了左括号，在黑板上写一个&quot;Open&quot;</div><div class="line">            [^&lt;&gt;]*       #匹配左括号后面的不是括号的内容</div><div class="line">        )+</div><div class="line">        (</div><div class="line">            (?&apos;-Open&apos;&gt;)   #碰到了右括号，擦掉一个&quot;Open&quot;</div><div class="line">            [^&lt;&gt;]*        #匹配右括号后面不是括号的内容</div><div class="line">        )+</div><div class="line">    )*</div><div class="line">    (?(Open)(?!))         #在遇到最外层的右括号前面，判断黑板上还有没有没擦掉的&quot;Open&quot;；如果还有，则匹配失败</div><div class="line"></div><div class="line">&gt;                         #最外层的右括号</div></pre></td></tr></table></figure>
<p>平衡组的一个最常见的应用就是匹配HTML,下面这个例子可以匹配嵌套的<div>标签：<div[^>]<em>&gt;[^&lt;&gt;]</em>(((?’Open’<div[^>]<em>&gt;)[^&lt;&gt;]</em>)+((?’-Open’</div[^></div[^></div>)[^&lt;&gt;]<em>)+)</em>(?(Open)(?!)).</p>
<h2 id="还有些什么东西没提到"><a href="#还有些什么东西没提到" class="headerlink" title="还有些什么东西没提到"></a>还有些什么东西没提到</h2><p>上边已经描述了构造正则表达式的大量元素，但是还有很多没有提到的东西。下面是一些未提到的元素的列表，包含语法和简单的说明。你可以在网上找到更详细的参考资料来学习它们–当你需要用到它们的时候。如果你安装了MSDN Library,你也可以在里面找到.net下正则表达式详细的文档。</p>
<p>这里的介绍很简略，如果你需要更详细的信息，而又没有在电脑上安装MSDN Library,可以查看<a href="http://msdn.microsoft.com/zh-cn/library/az24scfc.aspx" target="_blank" rel="external">关于正则表达式语言元素的MSDN在线文档</a>。</p>
<table>
<thead>
<tr>
<th>代码/语法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>\a</td>
<td>报警字符(打印它的效果是电脑嘀一声)</td>
</tr>
<tr>
<td>\b</td>
<td>通常是单词分界位置，但如果在字符类里使用代表退格</td>
</tr>
<tr>
<td>\t</td>
<td>制表符，Tab</td>
</tr>
<tr>
<td>\r</td>
<td>回车</td>
</tr>
<tr>
<td>\v</td>
<td>竖向制表符</td>
</tr>
<tr>
<td>\f</td>
<td>换页符</td>
</tr>
<tr>
<td>\n</td>
<td>换行符</td>
</tr>
<tr>
<td>\e</td>
<td>Escape</td>
</tr>
<tr>
<td>\0nn</td>
<td>ASCII代码中八进制代码为nn的字符</td>
</tr>
<tr>
<td>\xnn</td>
<td>ASCII代码中十六进制代码为nn的字符</td>
</tr>
<tr>
<td>\unnnn</td>
<td>Unicode代码中十六进制代码为nnnn的字符</td>
</tr>
<tr>
<td>\cN</td>
<td>ASCII控制字符。比如\cC代表Ctrl+C</td>
</tr>
<tr>
<td>\A</td>
<td>字符串开头(类似^，但不受处理多行选项的影响)</td>
</tr>
<tr>
<td>\Z</td>
<td>字符串结尾或行尾(不受处理多行选项的影响)</td>
</tr>
<tr>
<td>\z</td>
<td>字符串结尾(类似$，但不受处理多行选项的影响)</td>
</tr>
<tr>
<td>\G</td>
<td>当前搜索的开头</td>
</tr>
<tr>
<td>\p{name}</td>
<td>Unicode中命名为name的字符类，例如\p{IsGreek}</td>
</tr>
<tr>
<td>(?&gt;exp)</td>
<td>贪婪子表达式</td>
</tr>
<tr>
<td>(?<x>-<y>exp)</y></x></td>
<td>平衡组</td>
</tr>
<tr>
<td>(?im-nsx:exp)</td>
<td>在子表达式exp中改变处理选项</td>
</tr>
<tr>
<td>(?im-nsx)</td>
<td>为表达式后面的部分改变处理选项</td>
</tr>
<tr>
<td>(?(exp)yes\</td>
<td>no)</td>
<td>把exp当作零宽正向先行断言，如果在这个位置能匹配，使用yes作为此组的表达式；否则使用no</td>
</tr>
<tr>
<td>(?(exp)yes)</td>
<td>同上，只是使用空表达式作为no</td>
</tr>
<tr>
<td>(?(name)yes\</td>
<td>no)</td>
<td>如果命名为name的组捕获到了内容，使用yes作为表达式；否则使用no</td>
</tr>
<tr>
<td>(?(name)yes)</td>
<td>同上，只是使用空表达式作为no</td>
</tr>
</tbody>
</table>
<p>网上的资源及本文参考文献</p>
<ul>
<li><a href="http://msdn.microsoft.com/library/chs/default.asp?url=/library/CHS/jscript7/html/jsreconintroductiontoregularexpressions.asp" target="_blank" rel="external">微软的正则表达式教程</a></li>
<li><a href="http://msdn2.microsoft.com/zh-cn/library/system.text.regularexpressions.regex.aspx" target="_blank" rel="external">System.Text.RegularExpressions.Regex类(MSDN)</a></li>
<li><a href="http://www.regular-expressions.info/" target="_blank" rel="external">专业的正则表达式教学网站(英文)</a></li>
<li><a href="http://weblogs.asp.net/whaggard/archive/2005/02/20/377025.aspx" target="_blank" rel="external">关于.Net下的平衡组的详细讨论（英文）</a></li>
<li><a href="http://www.oreilly.com/catalog/regex2/" target="_blank" rel="external">Mastering Regular Expressions (Second Edition)</a></li>
</ul>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/doc/2017-09-28/正则表达式30分钟入门教程/" data-id="cj8x49dob0009msm1l6g1vzbz" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-Markdown基本使用" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/doc/2017-09-21/Markdown基本使用/">Markdown基本使用</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/doc/2017-09-21/Markdown基本使用/">
            <time datetime="2017-09-21T07:42:33.000Z" itemprop="datePublished">2017-09-21</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/hexo/">hexo</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h3 id="图片嵌入"><a href="#图片嵌入" class="headerlink" title="图片嵌入"></a>图片嵌入</h3><p>使用URL链接的形式插入图片：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">![image][url_to_image]1</div></pre></td></tr></table></figure>
<p>这样做一个明显的麻烦之处在于处理图片与Markdown文档的一致性上。如果我们要拷贝文档，或者图片遭到误删/云端链接失效，就会变得不便。最让我们省心的方法便是将图片直接放到文档内部。</p>
<p>一个将图片嵌入文档中的方法是使用base64编码。步骤比较简单： </p>
<ol>
<li>将图片或截图保存在本地； </li>
<li>使用在线工具将图片转码至base64编码；(<a href="http://imgbase64.duoshitong.com/" target="_blank" rel="external">link1</a>, <a href="http://tool.css-js.com/base64.html" target="_blank" rel="external">link2</a>)； </li>
<li>在文档中插入编码：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">![image][data:image/png;base64, ......]1</div></pre></td></tr></table></figure>
<p>当然base64编码一般很长，直接将编码放入段落内部会影响正常编辑。通常的做法是将base64编码定义到一个中间变量中，将编码本体放到文档末：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">![image][tmp]</div><div class="line">your document here ...</div><div class="line"></div><div class="line">[tmp]:data:image/png;base64, ......1234</div></pre></td></tr></table></figure>
<p>使用该技巧的时候需要注意，并不是所有的Markdown编辑器都支持这种方法。而且一些Markdown编辑器只支持特定的图片格式。如有道云笔记只支持png格式的图片编码。需要在保存图片文件的时候加以注意。</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/doc/2017-09-21/Markdown基本使用/" data-id="cj8x49dno0002msm1tp9dytk1" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-开放式 ETL 系统的设计与实践" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/doc/2017-09-20/开放式 ETL 系统的设计与实践/">开放式 ETL 系统的设计与实践</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/doc/2017-09-20/开放式 ETL 系统的设计与实践/">
            <time datetime="2017-09-20T07:42:33.000Z" itemprop="datePublished">2017-09-20</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/软文收集/">软文收集</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h2 id="开放式-ETL-系统的设计与实践"><a href="#开放式-ETL-系统的设计与实践" class="headerlink" title="开放式 ETL 系统的设计与实践"></a>开放式 ETL 系统的设计与实践</h2><p>大家晚上好，感谢大家能来参加本次的在线分享，首先自我介绍一下，我是14年校招加入百度，之前在百度质量部参与EP相关的一些项目研发，15年加入百度外卖，主要负责数据仓库和ETL以及部分数据产品的开发。</p>
<p><img src="/doc/2017-09-20/开放式 ETL 系统的设计与实践/0.jpg" alt="img"></p>
<p>今天主要给大家介绍一下百度外卖这边在ETL方向的一些实践。整体分四块，第一块先介绍下ETL的需求来源，以及外卖这个业务在ETL中的一些场景特征，这些场景特征和后面讲到的ETL系统设计联系比较紧密。第二部分讲基于这些场景和业务，ETL都需要满足哪些特性，都针对性的做出了什么样的设计。第三部分介绍了整个数据的交付体系，在数据交付给业务使用时如何保证其可用性，如何做到生产进度透明化。第四部分是介绍如何通过数据的血缘关系，来做到数据可解释，同时基于数据血缘关系还可以做那些事，能带来什么样的特性。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/pJE78Atczrnep17bMEVRX5NgjEvqvvIVFhMLzuHD9WCVtUSE4WoywJZQNZA7Y0VwicwonebJBDiamT8tia4jibZQFg/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt="img"></p>
<p>聊ETL自然离不开仓库，ETL服务将数据入到仓库，最终也都是为了在仓库层面提供结构或半结构化的数据存储、提供面向主题的明细和聚合数据，更好的支持上层应用及业务。</p>
<p>外卖这边数据需求（也就是数据出口）主要分三大类：一，分析类需求。相信大多数业务后端RD都做过给老板或PM跑数的需求，其实这就是最原始的ETL需求，外卖这边每日的业务整体日报，分城市、分代理商的日报，以及各种通过“自如”自定义或订阅的报表，都是基于ETL系统在释放数据可用信号后开始跑相应的报表服务来实现依赖发送的。二，线上业务产品的需求。比如在面向商户的产品中，展示商户的流量、复购、潜在顾客等相关dashboard，都是基于仓库的数据统计分析出来的。再比如下发给bd的商机系统，为销售提供销售线索的指标；面向bd的kpi考核，kpi每个指标的口径定义，具体实现就是对应在ETL的处理逻辑上。除产品研发相关的业务外，同时支持公司内其他业务部门，如财务、预算等等。三，就是最能挖掘数据潜在价值的策略方向的应用，支撑rank、搜索推荐、画像等。良好的结构化数据和仓库层次划分，能极大减小数据挖掘在前期清洗和预处理的成本，同时提供便捷的数据使用方式，让业务部门能更加高效的专注于自己的业务领域。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/pJE78Atczrnep17bMEVRX5NgjEvqvvIVoJJldy1KaXb9gBYbvcQdSq8Bxicrkxty0zibicACjMMpiaE8hC6tr7tq5w/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt="img"></p>
<p>针对以上业务场景，在ETL中又有着怎样的数据场景，有哪些特别的地方呢，我们从这三个视角来看。</p>
<p>首先，从数据流上来讲，数据主要有两种流向，一种是从业务库中整表抽取或部分字段抽取。整表抽取，主要是业务端的一些维度表，量级不大，变更频率低。分字段抽取，这个是核心场景，一般的业务主体数据在OLTP场景中都会细分业务进行分库分表，那么对应在仓库中的一个主题数据，比如订单，其基础指标在业务库中就可能存的比较分散，比如订单ID、价格、状态等在一个表，订单退款详情、评论、投诉等信息在另一个库另几张表，那么就需要完成一个跨库跨表按订单id抽取后数据拼装的过程。另一种数据流向就是仓库内部表之间的流转，比如汇总表的指标需要用事实表和维度表进行关联后聚合得出，再比如商户事实表的商户日流水指标，需要订单表和商户维度表关联后聚合产出。</p>
<p>从逻辑视角来看，有两种逻辑映射场景，比如价格字段，在仓库的指标中细分为优惠前单价、优惠后单价，优惠前单价直接取业务库订单表中的“订单价格”即可，这是个1对1的映射关系；优惠后单价，就需要“订单价格”减去“商户补贴”减去“平台补贴”减去“支付补贴”，这是个多对一的关系。这里就涉及到一个细节问题，加入上述三个补贴字段在业务库的订单表中都是以单个字段形式存在于schema中，多对一的计算直接一个select sql就能计算出来，但如果是补贴字段放在一个压缩的json字符串中呢，就需要先解析后逐一取出再计算，就涉及到需要编码来解决了。</p>
<p>从业务视角来看，数据可分为事实数据、维度数据、迟到的事实（也可理解为会变化的维度），比如订单ID、商户名称，这是事实的固有属性，是不变的事实；维度数据，比如城市、配送类型等；迟到的事实，比如订单状态，在订单表中，它即是订单的一个事实指标也是订单的一个维度，但它是随时间线性渐变的，也就是说在数据抽取入仓库后，业务库还会发生变化，会出现数据一致性的问题，这时候就涉及到数据重入和更新的问题了。在外卖这个业务中，是电商+实时物流的形态，且业务周期较长，涉及到的角色主体和业务形态众多，如订单、商户、物流、用户、骑士、bd、营销、结算等等，可谓是订单类的场景中最复杂的一个。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/pJE78Atczrnep17bMEVRX5NgjEvqvvIVicz0kzcjkicPZSrYpw6QZeL6cszotnAxMywZictKbXFY9KKDpFOicsrUqw/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt="img"></p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/pJE78Atczrnep17bMEVRX5NgjEvqvvIVbho4SUiaGIBficACATBhdQmPOvBBiar4aSKJictTIV1Gb4WNRibictCnhECg/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt="img"> </p>
<p>面临以上复杂的场景和逻辑，如果每个ETL细节逻辑都靠编码来实现，且不说开发成本和数据解释成本，单是任务管理和代码继承及足以让开发者头疼不已。但是每一家公司的ETL基本上都是从最初的脚本+sql的形态开始，都会经历这个阶段。</p>
<p>在外卖ETL方向的发展可以分为这四个阶段，也是个人认为业内ETL整体发展的一个走向。从在关系型数据库上跑sql，写脚本解析数据，定时任务出报表开始，随着业务体量的发展，在计算性能和任务管理方式上很快就会遇到瓶颈，单机跑脚本会逐渐由分布式任务来代替。进入到第二阶段，map-reduce、spark之类的分布式任务和基于hadoop生态的一系列大数据解决方案实现了计算和存储的可扩展，但面临成千上万的任务，早期的ct任务靠时间约定来进行上下游约束，亦或在脚本中串行调用下游来实现，这种刀耕火种的方式在业务快速膨胀的过程中，面临的将是高昂的任务维护成本。在第三阶段，引入以调度为中心的，提供监控、任务重试机制、性能分析等一整套解决方案，来实现任务的串行依赖和并行计算的灵活组合。到这一步，就已经能解决绝大多数ETL场景的问题了。在第四阶段，做的就是ETL精细化，实现数据可用性监控，通过透明化数据生产进度，进而构建完整的数据交付体系，面临庞大的元数据体系如何降低数据解释成本，如何从表粒度的数据生产依赖，精细化到字段粒度。在这个阶段，核心就是让业务更加便捷更加自助式的使用数据，同时提升数据交付质量。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/pJE78Atczrnep17bMEVRX5NgjEvqvvIVRGElBrIJ2XIQ3H7aBbQs1uyzlzWIQ6UPiaZk5IrhPPmxZTias9tENV6w/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt="img"></p>
<p>接下来看下百度外卖这边整体数据生产的一个数据流架构。和业内所有的数据生产场景一样，主体分为数据源、生产、仓库、数据应用四层，数据源以业务库的mysql为主，其次是hdfs或ftp的文件、kafka/nmq（百度的消息队列）、api。生产层面以ETL系统为主，主要处理业务数据，日志的基础数据生产走spark streaming。</p>
<p>ETL系统的执行单元是个脚本命令，由调度系统远程调起，来实现分布式，调度由任务(job)-&gt;转换(transformer)-&gt;算子(operator)的粒度进行封装，通过这种结构关系实现ETL作业的先后依赖和并行处理。在数据生产的环节中，除通用的系统监控服务外，还开发了一套数据监控服务来保证数据产出后的可用性。</p>
<p>数据的例行生产由底层事实表和维度表开始，基于事实和维度生产一些中间表(也称为轻度聚合表)，然后是聚合表，这也是常见的一种仓库设计。就数据的使用层面来讲，事实明细+维度的查询是能满足所有查询场景的，灵活度也最高，但随着业务体量的发展，这种基于明细的查询会带来极大的冗余查询。试想不同的业务查询同一个指标，类似的sql每个人都需要跑一遍，冗余查询引发的将是大量集群的额外开销。所以设计基于明细数据的聚合表，是一种事前计算的思路，将不同指标在不同维度下的数据提前计算好，方便业务查询的同时也统一了数据口径。在上期大数据分享中提到的kylin，其性能高效的原理和建中间表是同理，基于各种维度预建好中间表，任意维度组合的查询都能直接落在一张表的数据文件上，极大减少了hdfs文件扫描的开销。</p>
<p>那么中间表该怎么建，这么多的维度组合和指标，不可能面面俱到，只能用有限的集群资源去解决热点的问题。哪些查询是热点的，不可能通过逐一收集用户需求来实现，在数据使用服务上我们开发了一套adhoc（即席查询）查询服务，所有的数据出口都收敛在这里，有面向BI分析人员的sql查询UI，也有面向后端服务的同步和异步接口，通过adhoc每天记录的用户查询日志，我们能分析出哪些表和字段是查询热点，都分部在什么维度。同时通过收敛查询的出口，在adhoc这个数据出口上建立了完整的字段粒度的数据权限控制。在ETL生产的过程中，配合信号灯服务，实现了数据生产可解释；通过在数据集市中的元数据管理系统，支持面向用户的元数据和口径查询。基于对ETL配置的解析，生产了数据的血缘关系，用于描述表的上下游及字段之间的生产流转关系。有了口径和数据血缘关系的描述，就极大降低了数据解释成本。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/pJE78Atczrnep17bMEVRX5NgjEvqvvIVkvAPZlJfRtrx1U6DJ6PTq44TTWWNs1YMrTiaLcTVKxVqrjEsVEvIU2Q/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt="img"></p>
<p>基于之上的整个生产数据流，再来看下ETL内部是如何实现流转的。在前面提到我们有基于事实明细聚合查询后回填到事实宽表的查询，比如在订单维度，标记该订单是否为用户的首个完成单。同时我们有接入api推送的数据，这类事实数据入库后，在下游应用在一些实时的dashboard上。还有针对迟到的事实这种场景，需要有单个字段回溯的场景，举个例子，比如订单状态，正常的餐饮订单一般在几个小时候才完成，但是会有些预订单或物流单，在订单创建数周之后才能完成。那么基于以上场景，需要有一套支持细粒度更新的数据存储解决方案，这里就引入了一层ODS，所有的数据拼装和转换结果都先入到ODS中，再sqoop到集群，同时也会有从集群聚合查询后回填到ods的场景。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/pJE78Atczrnep17bMEVRX5NgjEvqvvIVMd5jhqjIJyR99HOHUCboNcM616FkkDn1ZOqO2UO7iacS3brVKamU3vA/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt="img"></p>
<p>我们对ODS的定位：第一，在业务系统和仓库之间形成一个隔离层，ODS用于存放从业务系统直接抽取出来的数据，这些数据从数据结构、数据之间的逻辑关系上都与业务系统基本保持一致，因此在抽取过程中极大降低了数据转化的复杂性，而主要关注数据抽取的接口、数据量大小、抽取方式等方面的问题。第二，承担一部分业务系统的明细查询。对于明细查询的场景一般有三种，带主键的检索式查询、有时效性要求的OLTP条件检索、离线场景的明细拉取或聚合，对于前两种场景是适合放在ODS中的，面向OLAP的查询引擎无法满足其时效性。第三，支持业务的回溯更新场景。</p>
<p>在ODS的选型上，考虑过三种类型的存储：行增量式、列式、支持OLTP+OLAP混合的存储。这三种类型的存储，对应到这个数据场景下，需要不同的解决方案。行增量式以druid为例来讲，高性能写入，不支持更新。在外卖这边druid已经应用于日志的一些场景，那么能不能用它来解决业务数据呢，在一些特定场景下是可以的，外卖的绝大多数业务都是有主键属性的，还是拿订单状态来说，把订单的每次变更都当作一个事件，记录在druid中，下游的ETL按事件发生顺序倒叙排列取最新状态即可，但带来的问题就是会冗余存储大量过程状态，数据量级膨胀的系数取决于变化维度的枚举值个数。列式存储，基于MPP架构的以vertica和greenplum为例，其在大数据场景下的查询能力非常出色，但是针对数据回溯的场景，其满足不了批量DML操作的低延时性能要求。</p>
<p>我们需要的是一个融合低延迟写入和高性能分析的存储系统，结构化存储系统在hadoop生态里通常分为两类：静态数据和动态数据。静态数据，数据通常都是使用二进制格式存放到 HDFS 上面，譬如 Apache Avro，Apache Parquet。但无论是 HDFS 还是相关的系统，都是为高吞吐连续访问数据这些场景设计的，都没有很好的支持单独 record 的更新，或者是提供好的随机访问的能力。 动态数据，数据通常都是使用半结构化的方式存储，譬如 Apache HBase，Apache Cassandra。这些系统都能低延迟的读写单独的 record，但是对于一些像 SQL 分析这样需要连续大量读取数据的场景，显得有点捉紧见拙。上面的两种系统，各有自己的侧重点，一类是低延迟的随机访问特定数据，而另一类就是高吞吐的分析大量数据。简单来讲，我们需要的是一个OLTP+OLAP融合的存储系统，kudu和phoenix就是在两个特性之间找到了一个平衡点。我们线上目前用的是phoenix，它是一个基于hbase之上的组件，通过cm安装部署非常简易，因为是基于hbase的所以写入性能可扩展，而且hbase的运维比较成熟，作为一个新型引擎引入技术风险较小。Kudu作为当下的一个主流趋势，我们也搭建了测试集群正在摸索中。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/pJE78Atczrnep17bMEVRX5NgjEvqvvIV0gBmKqFPLUwJmSmgRpO2Rf2ic6EN4EUIX11l2ibqydVKEEHNjRyL9J5A/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt="img"></p>
<p>这里列了两张phoenix官方提供的OLAP场景下和hive、impala的性能对比图，在行数据递增的时候其查询性能耗时增长缓慢。在我们的实际应用经验中，phoenix的性能主要得益于内存的使用，当DML操作比较密集的时候同时进行复杂的DQL操作，内存吃紧的状态下其性能会显著下降，所以在外卖的使用场景中，phoenix主要用于解决行粒度更新的问题，复杂的OLAP操作在impala和hive中。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/pJE78Atczrnep17bMEVRX5NgjEvqvvIVBSa2FZ1gkCWztqMm7U0542EI6vzUjRcqxaIYRV7sOLv6v3kNyJLl2A/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt="img"></p>
<p>前面提到了调度系统由任务(job)-&gt;转换(transformer)-&gt;算子(operator)构成，算子是最小执行单元，在ETL的作业执行中，具体的一个算子就对应一个ETL作业，调度事先将作业在线上集群初始化，通过时间触发+任务依赖的方式选择宿主机调起任务，在宿主机选择时优先选择负载最低的节点执行。任务和转换在同一层级中，依赖关系均是有向无环图，每个节点的父子节点可能都会有多个。算子作为最小执行单元，一个转换中可能会有多个算子。在调度系统中为ETL设置了多种算子类型，比如ETL算子、sqoop算子、webservice算子等，通过预定义的参数填写来配置。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/pJE78Atczrnep17bMEVRX5NgjEvqvvIVqN7f0BQ0OOOZia2RIDicloicE3cZmUyDdZib2vk2OibichC3aBcBAsUuEdQQ/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt="img"></p>
<p>下面来讲讲ETL框架的流程设计。框架最核心的设计理念，是从ETL的场景出发，可以分为两大类。这两个类别能覆盖大约90%以上的需求，一些特殊场景基于配置无法满足的，按照框架定义的标准进行编码自定义class实现（比如数据源是按业务id hash分表，比如数据主体没有业务主键）。第一类，前面提到的字段之间多对多的映射关系，从上游查询出多个字段，经过转换后插入下游某个表，如果转换逻辑可通过sql实现，对应的其实就是一个insert from select 的语法。那么在异构存储的系统中，可能会涉及到多个数据源的相互转换，无法用一个sql搞定，这个就是开放式sql做的事情，将这类的生产逻辑都转化为一张配置表，将数据抽取和装载分开执行。第一类是相对简单且常见的场景，那么针对转换逻辑无法通过sql实现的场景，我们设计了开放式index，一个针对字段粒度的etl方式。图中开发式index的配置里db¬_connect、db_connect_table、select_sql三个参数描述从哪去取源数据，db_connect_engine、fact_table、index_column描述数据往哪插入，写入哪个字段，对于需要用coding进行逻辑转换的，在handle_flag中指定自定义函数，自定义函数通过约束统一输入输出的格式来对接到上下游数据流，剩下的字段多为配置的描述性字段，如是否可回溯、指标分类、生效时间等。</p>
<p>基于这两类配置来看下流程图，首先初始化参数和配置，比如要生产表明为t1的表，根据参数中的设定检查对应目标表的分区是否存在，不存在就先创建，然后写入信号灯，告诉信号灯t1表开始生产了。开始进入正式的生产流程，第一步判断是否有自定义编码，有的话先加载执行，第二步查询open sql的配置，如果发现t1表的生产对应多条开放式sql的配置，则顺序执行，同时也支持在传参入口传入指定配置编号来细粒度执行。第三步查询open index，得到多条配置，以计算t1.f1 和t1.f2为例，两个字段对应不同的数据源不同的逻辑，先独立执行数据抽取，然后执行各自独立的自定义函数（如果有的话），然后再对处理结果进行merge，拼装成一个upsert语句进行插入。第四步，调用监控服务判断生产结果是否符合预期标准。第五步，写入信号灯告诉信号灯生产完成。整体ETL的生产，结合了ODS支持upsert的特性，加上open index的细粒度生产配置，实现了数据的细粒度生产与回溯；生产作业命令的参数支持按表和多字段传入，实现了计算粒度可伸缩，可整表批处理生产也可生产单个字段；同时支持ETL配置热加载，随时修改随时上线。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/pJE78Atczrnep17bMEVRX5NgjEvqvvIVoJ257r2via4Zs7fq2CV0qVzdLk11mYtwnDglDwaGV0g6TthTIcvF3Yw/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt="img"></p>
<p>这是一个开放式sql的配置示例，截图了配置的部分字段，可以看到前两个字段描述了数据源，然后描述了数据往哪写，在转换逻辑中，查询sql的字段和写入sql的字段是一一映射的。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/pJE78Atczrnep17bMEVRX5NgjEvqvvIV26AccyNbCltt1gzLzRqzuLian65n4n2xoLq3tVMp5bQ18VBobsziaaVQ/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt="img"></p>
<p>是一个open index中函数编码的示例，计算“代理商抽佣金额”这个指标，函数的入口统一标准格式，输入为主题数据的二维数组，数组的key为业务主键，数组第一维表示数据行，第二维表示数据列，在这个示例中需要对入参的多列分别json反解析后再进行数学逻辑运算，结果集作为新增列再填回维护数组并返回。针对这种业务逻辑复杂，需要反解自定义加密、解析复杂的数据结构的场景，我们只能编写业务代码来处理，open index支持自定义函数的设计很好的解决了这方面的扩展性。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/pJE78Atczrnep17bMEVRX5NgjEvqvvIV51dQI377Axd7JWZYdc1kFF0kD2ibMzjSfyFuJ2AQvgHyB0VucgGLLGA/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt="img"></p>
<p>除了ETL计算的流程之外，整个ETL系统中还有重要的一环就是sqoop，我们对开源工具进行了封装，在其基础上加入了分区自动创建、并发控制、字段类型映射等功能。现在来看下sqoop的处理流程，首先在选择数据源、创建分区后，第一步先进行schema diff，做这一步主要是为了解决线上库schema变更下游未及时更改导致sqoop失败的问题，且线上业务变更数据库的操作经常在夜间进行，对大数据运维来讲同步跟进的成本很高，且夜间是数据生产的高峰期。这里我们开发了一套工具用来事前录入变更schema，通过版本控制，在检测到schema有差异时自动去加载最新的schema版本对线上hive/impala进行变更。第二步针对要同步的数据count量级，一方面是用于并发的边界处理，一方面用于同步完成后进行数据量级校验。第三步进行边界处理，即对应原生工具中的-split-by和-m参数，用于控制同步的并发度和数据倾斜。第四步进行字段映射处理，由于sqoop本质是通过一个mr任务抽取数据后生成数据文件，hive在建表关联时会存在很多字段映射的问题，比如mysql中的bigint unsigned 类型，但在hive中只有bigint类型，符号位占据了一位所以其长度不够，这种情况都需要在hive中转为string。第五步是基于配置的压缩处理，对应—compress参数。以上几步完成sqoop的命令拼装，执行后就产出数据文件了，之后释放数据生产完成信号，然后针对同步的表进行hdfs缓存池的维护，最后在impala进行元数据的compute（数据出口有hive、impala、greenplum三种引擎）。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/pJE78Atczrnep17bMEVRX5NgjEvqvvIVhx9YxCEVqXpolxksFf2s1uJOibhGdroQMzdU5fJ8pk2e7PUA5cCwndA/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt="img"></p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/pJE78Atczrnep17bMEVRX5NgjEvqvvIVugJamGQ7zxWlv9Vvf4O6BYMibBribLsN1xqCVYW6icfPXMBEAMAEAI3Yw/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt="img"></p>
<p>以上，介绍了数据生产的核心流程，但从系统的层面来讲，数据生产完成不等于数据可用。从数据生产到交付至业务使用的场景中，经常会遇到数据生产任务执行异常、生产任务延迟、生产结果异常等，对于任务执行异常或延时，调度系统都会进行重试和报警，对于生产结果的异常，就得从数据本身去判断处理了。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/pJE78Atczrnep17bMEVRX5NgjEvqvvIVfJx9A4OXVg0BEOMY0nle0uZsjdic7EIJLZzaV014dtlKI5Q9bn8y0ZA/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt="img"></p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/pJE78Atczrnep17bMEVRX5NgjEvqvvIVt9e9QbSVH58ib2lTphr8SeMVaZFCY39HwA5ugXyHUxmHxbLNQr5JzUg/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt="img"></p>
<p>对于数据的质量问题，我们在生产任务的前后都设置了checkpoint，前置的checkpoint用于检查它所依赖的上游数据是否符合预期，后置的checkpoint用于检查自身产出的数据是否符合标准。那么具体的逻辑就是由监控服务来实现，和常见的监控服务类似，由用户自定义配置监控项，进行定时check。在数据监控服务中，和常规系统监控服务的差异在于这里的配置分为表结构监控和数据可用性监控，后者由sql实现同源或异源数据的对比、环比同比的阈值监控、空值率及类型监控，同时对于不同阈值触发不同的监控报警级别和处理措施，例如“订单量”环比波动超过20%就邮件报警，超过50%就短信电话报警，“流量转化率”为负数就停止生产任务等。监控服务同时提供api触发check的功能，由调度的webservice算子或执行脚本进行自主调用，更加灵活的支持在关键流程中设置check任务，检测到异常则终止整个生产任务流，下游生产将不会被触发直到异常点恢复。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/pJE78Atczrnep17bMEVRX5NgjEvqvvIVwfaTRp1fwB5hGS3cVo1ibRRanBLty0IOdybf4nkR8RgU09Um6GiblV1A/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt="img"></p>
<p>对于数据交付流程上来讲，用户还会关心任务的生产进度，信号灯服务从命名上就可以看出是用来释放数据生产信号的。在前面介绍ETL作业流程中就已经提到，在生产初始和结束时都会调用信号灯的接口，来释放信号。信号灯服务提供了信号写入api和信号查询api，对于下游系统来讲只需要监测数据可用信号即可，在服务层面实现了通过api解耦。在数据的上下游关系中，业内常见的依赖都是整表依赖，整表依赖的最大痛点在于对于宽表来说，下游的生产开始时间取决于上游最后一个字段的生产结束时间，而依赖关系中可能只是使用到了上游的部分字段。在前面介绍的ETL生产流程中，我们的ETL系统已经支持到了字段粒度的生产，那么对于数据交付来讲，信号灯的信号释放表现在字段粒度，就可以做到字段粒度的作业流依赖。</p>
<p>以上，构建了完整的数据交付体系</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/pJE78Atczrnep17bMEVRX5NgjEvqvvIVHvB71aDC3UImvWSwARqUtVlJxdq4m9jIibnrqZ0U8HFgFbIKnIKNiaiaA/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt="img"></p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/pJE78Atczrnep17bMEVRX5NgjEvqvvIVYUfp9cxwqhpY8Wd3r0lSGF2WsRG0ibXbsTktVehfMMySXUP8Rz4mnqw/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt="img"></p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/pJE78Atczrnep17bMEVRX5NgjEvqvvIVbs5VjFa2ic8W4ufrroewsVic0McXJ4icUwqWFdibuULtm2qJs9bXnszBkw/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt="img"></p>
<p>在数据使用层面，数据的可解释性是所有大数据团队的一个痛点。数据可解释主要包含两个方面：数据口径和数据依赖关系。ETL开发者经常面临的一个问题就是要向数据使用方解释你的数据是如何生产出来的。在业内常见的生产依赖关系都是数据表和生产任务之间的依赖，对于生产任务具体用到了上游数据表中的哪些字段只有在编码逻辑中才能体现，是无法暴露给数据使用方的。由于我们的ETL系统绝大多数生产逻辑都是基于配置的，因此通过配置文件即可解析出数据上下游的生产依赖关系 - -即数据血缘关系。在调度配置的任务中，一个任务对应一张表的生产，通过血缘关系可以清晰看到这个任务在数据层面的依赖关系，做到数据可解释、生产过程可解释。</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/doc/2017-09-20/开放式 ETL 系统的设计与实践/" data-id="cj8x49dob0007msm1w2u2f65g" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-开源监控软件对比_zabbix" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/doc/2017-09-18/开源监控软件对比_zabbix/">开源监控软件对比_zabbix</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/doc/2017-09-18/开源监控软件对比_zabbix/">
            <time datetime="2017-09-18T07:42:33.000Z" itemprop="datePublished">2017-09-18</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/软文收集/">软文收集</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h2 id="开源监控软件对比"><a href="#开源监控软件对比" class="headerlink" title="开源监控软件对比"></a>开源监控软件对比</h2><ul>
<li><strong>Cacti**</strong>（英文含义仙人掌）**</li>
</ul>
<p>是一套基于PHP、MySQL、SNMP和RRDtool开发的网络流量监测图形分析工具，它通过snmpget来获取数据使用RRDtool绘图，简化RRDtool使用。提供了非常强大的数据和用户管理功能，可以指定每一个用户能查看树状结构、主机设备以及任何一张图，还可以与LDAP结合进行用户认证，同时也能自定义模板。在历史数据展示监控方面，其功能相当不错。</p>
<p>Cacti通过添加模板，使不同设备的监控添加具有可复用性，并且具备可自定义绘图的功能，具有强大的运算能力（数据的叠加功能）</p>
<ul>
<li><strong>nagios</strong></li>
</ul>
<p>Nagios是一款开源的免费网络监视工具，能有效监控Windows、Linux和Unix的主机状态，交换机路由器等网络设置，打印机等。</p>
<p>Nagios 可以监控的功能有：<br>1、监控网络服务（SMTP、POP3、HTTP、NNTP、PING等）；<br>2、监控主机资源（处理器负荷、磁盘利用率等）；<br>3、简单地<strong>插件设计</strong>使得用户可以方便地扩展自己服务的检测方法；<br>4、并行服务检查机制；<br>5、具备定义<strong>网络分层结构</strong>的能力，用”parent”主机定义来表达网络主机间的关系，这种关系可被用来发现和明晰主机宕机或不可达状态；<br>6、当服务或主机问题产生与解决时将告警发送给联系人（通过EMail、短信、用户定义方式）；<br>7、具备定义事件句柄功能，它可以在主机或服务的事件发生时获取更多问题定位；<br>8、自动的日志回滚；<br>9、可以支持并实现对主机的冗余监控；<br>10、可选的WEB界面用于查看当前的网络状态、通知和故障历史、日志文件等；</p>
<ul>
<li>Ganglia</li>
</ul>
<p>是一个跨平台的、可扩展的、<strong>高性能</strong>的分布式监控系统，如集群和网格。它基于<strong>分层设计</strong>，使用广泛的技术，用RRDtool存储数据。具有可视化界面，适合对集群系统的自动化监控。其精心设计的数据结构和算法使得监控端到被监控端的连接开销非常低。目前已经有成千上万的集群正在使用这个监控系统，可以轻松的处理2000个节点的集群环境。</p>
<p>Ganglia的强大在于：ganglia服务端能够通过一台客户端收集到同一个网段的所有客户端的数据，ganglia集群服务端能够通过一台服务端收集到它下属的所有客户端数据。</p>
<ul>
<li><strong>Zabbix</strong></li>
</ul>
<p>是一个基于web界面的分布式监控系统，支持多种采集方式采集客户端，有专用的Agent代理，也支持SNMP、IPMI、JMX、Telnet、SSH等多种协议，它将采集到的数据存放到数据库，然后对其进行分析整理，达到条件触发告警。其灵活的扩展性和丰富的功能是其他监控系统所不能比的。</p>
<p><a href="http://images2015.cnblogs.com/blog/856286/201603/856286-20160302231227923-1370234025.jpg" target="_blank" rel="external"><img src="http://images2015.cnblogs.com/blog/856286/201603/856286-20160302231229283-64771159.jpg" alt="clip_image002"></a></p>
<p>结论：</p>
<p>从以上各种监控系统的对比来看，Zabbix都是具有优势的，其丰富的功能、可扩展的能力、二次开发的能力和简单易用的特点，读者只要稍加学习，即可构建自己的监控系统。</p>
<h2 id="Zabbix"><a href="#Zabbix" class="headerlink" title="Zabbix"></a>Zabbix</h2><h3 id="选择zabbix的理由："><a href="#选择zabbix的理由：" class="headerlink" title="选择zabbix的理由："></a>选择zabbix的理由：</h3><p>- 安装与配置简单，学习成本低<br>- 支持多语言（包括中文）<br>- 免费开源</p>
<p>- 数据采集到数据库，可二次分析监控数据的。<br>- 自动发现服务器与网络设备<br>- 分布式监视以及WEB集中管理功能<br>- 可以无agent监视<br>- 用户安全认证和柔软的授权方式<br>- 通过WEB界面设置或查看监视结果<br>- email等通知功能<br>等等</p>
<h3 id="组成："><a href="#组成：" class="headerlink" title="组成："></a>组成：</h3><p>zabbix server：可以通过SNMP、zabbixagent、ping、端口监视等方法提供对远程服务器/网络状态的监视，数据收集等功能，它可以运行在Linux, Solaris, HP-UX, AIX, Free BSD, Open BSD, OS X等平台之上。</p>
<p>zabbix agent（可选组件）：安装在被监视的目标服务器上，它主要完成对硬件信息或与操作系统有关的内存，CPU等信息的收集。</p>
<h3 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h3><p><a href="http://images2015.cnblogs.com/blog/856286/201603/856286-20160302231229751-1485347326.jpg" target="_blank" rel="external"><img src="http://images2015.cnblogs.com/blog/856286/201603/856286-20160302231230501-657878972.jpg" alt="clip_image004"></a></p>
<p>目前推荐使用<strong>Zabbix2.2</strong></p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><h4 id="准备："><a href="#准备：" class="headerlink" title="准备："></a>准备：</h4><p>epel源、mysql已安装(yum install mysql-server)、zabbix官方仓库（<a href="http://repo.zabbix.com/" target="_blank" rel="external">http://repo.zabbix.com/</a>）</p>
<ol>
<li><strong>安装epel源</strong></li>
</ol>
<p># wget –O  /etc/yum.repos.d/epel.repo <a href="http://mirrors.aliyun.com/repo/epel-6.repo" target="_blank" rel="external">http://mirrors.aliyun.com/repo/epel-6.repo</a></p>
<ol>
<li><strong>安装Zabbix官方源码：</strong></li>
</ol>
<p>#rpm -ivh <a href="http://repo.zabbix.com/zabbix/2.2/rhel/6/x86_64/zabbix-release-2.2-1.el6.noarch.rpm" target="_blank" rel="external">http://repo.zabbix.com/zabbix/2.2/rhel/6/x86_64/zabbix-release-2.2-1.el6.noarch.rpm</a></p>
<h4 id="安装zabbix-server："><a href="#安装zabbix-server：" class="headerlink" title="安装zabbix server："></a>安装zabbix server：</h4><p>\3. 安装依赖包yum install -y OpenIPMI</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<p>\4. yum install -y zabbix-server zabbix-server-mysql</p>
<p><a href="http://images2015.cnblogs.com/blog/856286/201603/856286-20160302231232455-351075957.jpg" target="_blank" rel="external"><img src="http://images2015.cnblogs.com/blog/856286/201603/856286-20160302231233033-482209523.jpg" alt="clip_image008"></a></p>
<ol>
<li><strong>创建数据库</strong></li>
</ol>
<p><a href="javascript:void(0" target="_blank" rel="external"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a>;)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">mysql&gt; create database zabbix;</div><div class="line"></div><div class="line">mysql&gt; grant all on zabbix.* to zabbix@localhost identified by &quot;zabbix_pass&quot;;</div><div class="line"></div><div class="line"># mysql -uzabbix -pzabbix_pass -hlocalhost zabbix # 测试</div><div class="line"></div><div class="line"># rpm -ql zabbix-server-mysql</div><div class="line"></div><div class="line">导入server端数据表（注意顺序）：</div><div class="line"></div><div class="line"># mysql -uzabbix -pzabbix_pass -hlocalhost zabbix &lt;/usr/share/doc/zabbix-server-mysql-2.2.11/create/schema.sql  &lt;--导入数据结构</div><div class="line"></div><div class="line">#mysql -uzabbix -pzabbix_pass -hlocalhost zabbix &lt;/usr/share/doc/zabbix-server-mysql-2.2.11/create/images.sql  &lt;--导入图片</div><div class="line"></div><div class="line"># mysql -uzabbix -pzabbix_pass -hlocalhost zabbix &lt;/usr/share/doc/zabbix-server-mysql-2.2.11/create/data.sql   &lt;--导入数据</div></pre></td></tr></table></figure>
<p><a href="javascript:void(0" target="_blank" rel="external"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a>;)</p>
<ol>
<li><strong>修改配置文件</strong> # vim /etc/zabbix/zabbix_server.conf   &lt;–增加zabbix使用数据库的密码</li>
</ol>
<p>[root@zabbix-server ~]# egrep -v “^#|^$” /etc/zabbix/zabbix_server.conf</p>
<p>LogFile=/var/log/zabbix/zabbix_server.log</p>
<p>LogFileSize=0</p>
<p>PidFile=/var/run/zabbix/zabbix_server.pid</p>
<p><strong>DBHost=localhost</strong></p>
<p><strong>DBName=zabbix</strong></p>
<p><strong>DBUser=zabbix</strong></p>
<p><strong>DBPassword=zabbix_pass </strong>  &lt;–需修改同数据库设置<em>**</em></p>
<p>DBSocket=/tmp/mysql.sock </p>
<p>SNMPTrapperFile=/var/log/snmptt/snmptt.log</p>
<p>AlertScriptsPath=/usr/lib/zabbix/alertscripts</p>
<p>ExternalScripts=/usr/lib/zabbix/externalscripts</p>
<ol>
<li><strong>启动zabbix server</strong>：</li>
</ol>
<p>#service zabbix-server start</p>
<p># netstat -ntlpu|grep 10051 ß检查启动状态</p>
<p># chkconfig zabbix-server on   ß添加开机启动</p>
<h4 id="server端安装zabbix-web："><a href="#server端安装zabbix-web：" class="headerlink" title="server端安装zabbix web："></a>server端安装zabbix web：</h4><p>\1. # yum install zabbix-web zabbix-web-mysql</p>
<p><a href="http://images2015.cnblogs.com/blog/856286/201603/856286-20160302231233658-602110986.jpg" target="_blank" rel="external"><img src="http://images2015.cnblogs.com/blog/856286/201603/856286-20160302231234408-600666281.jpg" alt="clip_image012"></a></p>
<p>默认安装了httpd服务，启动httpd</p>
<p># chkconfig httpd on    ß添加开机启动</p>
<p>\2. 访问<a href="http://ip/zabbix" target="_blank" rel="external">http://ip/zabbix</a>进入安装</p>
<p><a href="http://images2015.cnblogs.com/blog/856286/201603/856286-20160302231234876-404563067.jpg" target="_blank" rel="external"><img src="http://images2015.cnblogs.com/blog/856286/201603/856286-20160302231235564-1308699009.jpg" alt="clip_image014"></a></p>
<p>==&gt;<strong>解决</strong>：修改时区 # vim /etc/httpd/conf.d/zabbix.conf</p>
<p><a href="http://images2015.cnblogs.com/blog/856286/201603/856286-20160302231236158-1130877742.jpg" target="_blank" rel="external"><img src="http://images2015.cnblogs.com/blog/856286/201603/856286-20160302231236705-822655594.jpg" alt="clip_image016"></a></p>
<ol>
<li><p><strong>登录</strong>默认用户admin 密码：zabbix</p>
</li>
<li><p><strong>修改字体</strong></p>
</li>
</ol>
<p>vim /usr/share/zabbix/include/locales.inc.php</p>
<p>yum -y install wqy-microhei-fonts ß安装中文字体集</p>
<p>rm -f /etc/alternatives/zabbix-web-font #删除原有字体连接文件</p>
<p>ln -s /usr/share/fonts/wqy-microhei/wqy-microhei.ttc /etc/alternatives/zabbix-web-font</p>
<h4 id="安装agent"><a href="#安装agent" class="headerlink" title="安装agent"></a>安装agent</h4><p>客户端和服务端都安装</p>
<p>\1. # yum install -y zabbix-agent</p>
<p><a href="http://images2015.cnblogs.com/blog/856286/201603/856286-20160302231237220-1600455322.jpg" target="_blank" rel="external"><img src="http://images2015.cnblogs.com/blog/856286/201603/856286-20160302231237642-429558313.jpg" alt="clip_image018"></a></p>
<p># vim /etc/zabbix/zabbix_agentd.conf     //修改被动模式IP为zabbix server ip</p>
<p><a href="http://images2015.cnblogs.com/blog/856286/201603/856286-20160302231238033-1708506885.jpg" target="_blank" rel="external"><img src="http://images2015.cnblogs.com/blog/856286/201603/856286-20160302231238455-857696247.jpg" alt="clip_image020"></a></p>
<p><strong>注</strong>：（一个Agent是可以同时向多个服务器端发送数据，多个Ip用逗号隔开）</p>
<p>Server：被动模式，允许哪台服务器连接Agent。</p>
<p>ServerActive：主动模式，向哪台服务器传送数据。</p>
<p># /etc/init.d/zabbix-agent start //启动agent</p>
<p># netstat -lntp |grep 10050 //验证端口</p>
<p>如果提示不能正常运行，分别检查zabbix_server.conf中的各项配置文件、Selinux、Iptables等。配置文件请检查以下文件的正确配置参数。</p>
<p>1./etc/zabbix/zabbix_server.conf中的参数。</p>
<p>#<br>DBHost=localhost         ß数据库的IP(域名)地址</p>
<p>DBName=zabbix              ß数据库的名称</p>
<p>DBUser=zabbix                ß数据库的用户</p>
<p>DBPassword=zabbix        ß数据库的密码</p>
<p>2./etc/zabbix/web/zabbix.conf.php中的配置。</p>
<p>[root@linux-node1 ~]# cat<br>/etc/zabbix/web/zabbix.conf.php</p>
<p>&lt;?php</p>
<p>// Zabbix GUI configuration file.</p>
<p>global $DB;</p>
<p>$DB[‘TYPE’]    = ‘MYSQL’;          //数据库类型</p>
<p>$DB[‘SERVER’]  = ‘localhost’;              //数据库的IP（域名）地址</p>
<p>$DB[‘PORT’]    = ‘0’;           //数据库的端口</p>
<p>$DB[‘DATABASE’] = ‘zabbix’;           //数据库的名称</p>
<p>$DB[‘USER’]    = ‘zabbix’;            //数据库的用户</p>
<p>$DB[‘PASSWORD’] = ‘zabbix’;          //数据库的密码</p>
<p>// Schema name. Used for IBM DB2 and PostgreSQL.</p>
<p>$DB[‘SCHEMA’] = ”;</p>
<p>$ZBX_SERVER     = ‘localhost’;          ßZabbix-Server的IP（域名）地址</p>
<p>$ZBX_SERVER_PORT = ‘10051’;              ßZabbix-Server的端口</p>
<p>$ZBX_SERVER_NAME = ‘Zabbix-Xuliangwei’;          ßZabbix-Server web界面的标识</p>
<p>$IMAGE_FORMAT_DEFAULT = IMAGE_FORMAT_PNG;</p>
<p>?&gt;</p>
<h3 id="监控流程"><a href="#监控流程" class="headerlink" title="监控流程"></a>监控流程</h3><p><a href="http://images2015.cnblogs.com/blog/856286/201603/856286-20160302231238970-1704404905.png" target="_blank" rel="external"><img src="http://images2015.cnblogs.com/blog/856286/201603/856286-20160302231239658-629855012.png" alt="image"></a></p>
<h3 id="Zabbix-Get使用"><a href="#Zabbix-Get使用" class="headerlink" title="Zabbix-Get使用"></a>Zabbix-Get使用</h3><p>Zabbix-Get是Zabbix中的一个程序，用于Zabbix-Server到Zabbix-Agent的数据获取，通常可以用来检测验证Agent的配置是否正确。</p>
<p>用法：zabbix_get [-hV] -s <host name="" or="" ip=""> [-p <port>] [-I <ip address="">] -k <key></key></ip></port></host></p>
<p>-s：远程Zabbix-Agent的IP地址或者是主机名。</p>
<p>-p：远程Zabbix-Agent的端口。</p>
<p>-l：本机出去的IP地址，用于一台机器中又多个网卡的情况。</p>
<p>-k：获取远程Zabbix-Agent数据所使用的Key。</p>
<h4 id="实现监控cpu（zabbix-server主机上操作）"><a href="#实现监控cpu（zabbix-server主机上操作）" class="headerlink" title="实现监控cpu（zabbix server主机上操作）"></a>实现监控cpu（zabbix server主机上操作）</h4><p># yum install -y zabbix-get //安装zabbix-get工具</p>
<p># zabbix_get -s 192.168.3.113 -k system.cpu.util[,user]</p>
<p><a href="http://images2015.cnblogs.com/blog/856286/201603/856286-20160302231240095-1864992364.jpg" target="_blank" rel="external"><img src="http://images2015.cnblogs.com/blog/856286/201603/856286-20160302231241064-270046254.jpg" alt="clip_image024"></a></p>
<p>Agent数据采集方式：passive、active</p>
<p>Other Agent：SNMP、IPMI、Java Gateway</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/doc/2017-09-18/开源监控软件对比_zabbix/" data-id="cj8x49dob0008msm1j003q1ar" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-Hexo使用笔记" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/doc/2017-09-16/Hexo使用笔记/">Hexo基础使用</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/doc/2017-09-16/Hexo使用笔记/">
            <time datetime="2017-09-16T07:42:33.000Z" itemprop="datePublished">2017-09-16</time>
        </a>
    </div>


                        
                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h2 id="什么是-Hexo？"><a href="#什么是-Hexo？" class="headerlink" title="什么是 Hexo？"></a>什么是 Hexo？</h2><p>Hexo 是一个快速、简洁且高效的博客框架。Hexo 使用 <a href="http://daringfireball.net/projects/markdown/" target="_blank" rel="external">Markdown</a>（或其他渲染引擎）解析文章，在几秒内，即可利用靓丽的主题生成静态网页。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>安装 Hexo 只需几分钟时间，若您在安装过程中遇到问题或无法找到解决方式，请<a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">提交问题</a>，我会尽力解决您的问题。</p>
<h3 id="安装前提"><a href="#安装前提" class="headerlink" title="安装前提"></a>安装前提</h3><p>安装 Hexo 相当简单。然而在安装前，您必须检查电脑中是否已安装下列应用程序：</p>
<ul>
<li><a href="http://nodejs.org/" target="_blank" rel="external">Node.js</a></li>
<li><a href="http://git-scm.com/" target="_blank" rel="external">Git</a></li>
</ul>
<p>如果您的电脑中已经安装上述必备程序，那么恭喜您！接下来只需要使用 npm 即可完成 Hexo 的安装。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install -g hexo-cli</div></pre></td></tr></table></figure>
<p>如果您的电脑中尚未安装所需要的程序，请根据以下安装指示完成安装。</p>
<blockquote>
<p>Mac 用户</p>
<p>您在编译时可能会遇到问题，请先到 App Store 安装 Xcode，Xcode 完成后，启动并进入 <strong>Preferences -&gt; Download -&gt; Command Line Tools -&gt; Install</strong> 安装命令行工具。</p>
</blockquote>
<h3 id="安装-Git"><a href="#安装-Git" class="headerlink" title="安装 Git"></a>安装 Git</h3><ul>
<li>Windows：下载并安装 <a href="https://git-scm.com/download/win" target="_blank" rel="external">git</a>.</li>
<li>Mac：使用 <a href="http://mxcl.github.com/homebrew/" target="_blank" rel="external">Homebrew</a>, <a href="http://www.macports.org/" target="_blank" rel="external">MacPorts</a> ：<code>brew install git</code>;或下载 <a href="http://sourceforge.net/projects/git-osx-installer/" target="_blank" rel="external">安装程序</a> 安装。</li>
<li>Linux (Ubuntu, Debian)：<code>sudo apt-get install git-core</code></li>
<li>Linux (Fedora, Red Hat, CentOS)：<code>sudo yum install git-core</code></li>
</ul>
<blockquote>
<p>Windows 用户</p>
<p>由于众所周知的原因，从上面的链接下载git for windows最好挂上一个代理，否则下载速度十分缓慢。也可以参考<a href="https://github.com/waylau/git-for-win" target="_blank" rel="external">这个页面</a>，收录了存储于百度云的下载地址。</p>
</blockquote>
<h3 id="安装-Node-js"><a href="#安装-Node-js" class="headerlink" title="安装 Node.js"></a>安装 Node.js</h3><p>安装 Node.js 的最佳方式是使用 <a href="https://github.com/creationix/nvm" target="_blank" rel="external">nvm</a>。</p>
<p>cURL:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ curl https://raw.github.com/creationix/nvm/master/install.sh | sh</div></pre></td></tr></table></figure>
<p>Wget:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ wget -qO- https://raw.github.com/creationix/nvm/master/install.sh | sh</div></pre></td></tr></table></figure>
<p>安装完成后，重启终端并执行下列命令即可安装 Node.js。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ nvm install stable</div></pre></td></tr></table></figure>
<p>或者您也可以下载 <a href="http://nodejs.org/" target="_blank" rel="external">安装程序</a> 来安装。</p>
<blockquote>
<p>Windows 用户</p>
<p>对于windows用户来说，建议使用安装程序进行安装。安装时，请勾选<strong>Add to PATH</strong>选项。<br>另外，您也可以使用<strong>Git Bash</strong>，这是git for windows自带的一组程序，提供了Linux风格的shell，在该环境下，您可以直接用上面提到的命令来安装Node.js。打开它的方法很简单，在任意位置单击右键，选择“Git Bash Here”即可。由于Hexo的很多操作都涉及到命令行，您可以考虑始终使用<strong>Git Bash</strong>来进行操作。</p>
</blockquote>
<h3 id="安装-Hexo"><a href="#安装-Hexo" class="headerlink" title="安装 Hexo"></a>安装 Hexo</h3><p>所有必备的应用程序安装完成后，即可使用 npm 安装 Hexo。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install -g hexo-cli</div></pre></td></tr></table></figure>
<p>变量<br>全局变量<br>变量    描述<br>site    网站变量<br>page    针对该页面的内容以及 front-matter 所设定的变量。<br>config    网站配置<br>theme    主题配置。继承自网站配置。<br>_ (单下划线)    Lodash 函数库<br>path    当前页面的路径（不含根路径）<br>url    当前页面的完整网址<br>env    环境变量<br>网站变量<br>变量    描述<br>site.posts    所有文章<br>site.pages    所有分页<br>site.categories    所有分类<br>site.tags    所有标签<br>页面变量<br>页面（page）</p>
<p>变量    描述<br>page.title    页面标题<br>page.date    页面建立日期（Moment.js 对象）<br>page.updated    页面更新日期（Moment.js 对象）<br>page.comments    留言是否开启<br>page.layout    布局名称<br>page.content    页面的完整内容<br>page.excerpt    页面摘要<br>page.more    除了页面摘要的其余内容<br>page.source    页面原始路径<br>page.full_source    页面的完整原始路径<br>page.path    页面网址（不含根路径）。我们通常在主题中使用 url_for(page.path)。<br>page.permalink    页面的完整网址<br>page.prev    上一个页面。如果此为第一个页面则为 null。<br>page.next    下一个页面。如果此为最后一个页面则为 null。<br>page.raw    文章的原始内容<br>page.photos    文章的照片（用于相簿）<br>page.link    文章的外部链接（用于链接文章）<br>文章 (post): 和 page 布局类似，但是添加了下列变量。</p>
<p>Variable    Description<br>page.published    如果该文章已发布则为True<br>page.categories    该文章的所有分类<br>page.tags    该文章的所有标签<br>首页（index）</p>
<p>变量    描述<br>page.per_page    每页显示的文章数量<br>page.total    总文章数<br>page.current    目前页数<br>page.current_url    目前分页的网址<br>page.posts    本页文章<br>page.prev    上一页的页数。如果此页是第一页的话则为 0。<br>page.prev_link    上一页的网址。如果此页是第一页的话则为 ‘’。<br>page.next    下一页的页数。如果此页是最后一页的话则为 0。<br>page.next_link    下一页的网址。如果此页是最后一页的话则为 ‘’。<br>page.path    当前页面的路径（不含根目录）。我们通常在主题中使用 url_for(page.path)。<br>归档 (archive)：与 index 布局相同，但新增以下变量。</p>
<p>变量    描述<br>page.archive    等于 true<br>page.year    年份归档 (4位)<br>page.month    月份归档 (没有前导零的2位数)<br>分类 (category)：与 index 布局相同，但新增以下变量。</p>
<p>变量    描述<br>page.category    分类名称<br>标签 (tag)：与 index 布局相同，但新增以下变量。</p>
<p>变量    描述<br>page.tag    标签名称</p>
<h4 id="新建一个自定义页面"><a href="#新建一个自定义页面" class="headerlink" title="新建一个自定义页面"></a>新建一个自定义页面</h4><p>（以添加关于页为例）：<br>hexo new page about<br>编辑生成的 about/index.md 文件，设置布局为 page:<br>title: about<br>layout: page</p>
<h3 id="插件使用"><a href="#插件使用" class="headerlink" title="插件使用"></a>插件使用</h3><h4 id="hexo-asset-image"><a href="#hexo-asset-image" class="headerlink" title="hexo-asset-image"></a>hexo-asset-image</h4><p>Give asset image in hexo a absolutely path automatically</p>
<p>Usege</p>
<p>npm install hexo-asset-image –save<br>Example</p>
<p>MacGesture2-Publish<br>├── apppicker.jpg<br>├── logo.jpg<br>└── rules.jpg<br>MacGesture2-Publish.md<br>Make sure post_asset_folder: true in your _config.yml.</p>
<p>利用markdown标签</p>
<p> Just use <img src="/doc/2017-09-16/Hexo使用笔记/logo.jpg" alt="logo"> to insert logo.jpg.</p>
<p>利用标签引用</p>
 
 
 
<h4 id="hexo-tag-html5"><a href="#hexo-tag-html5" class="headerlink" title="hexo-tag-html5"></a>hexo-tag-html5</h4><p>Adding embedded html5 video to hexo</p>
<video width="100%" height="250px" controls><source src="  " type="video/webm"> Your browser does not support the webm tag.</video>
<p>Usage: With no args, the defaults are used: width = ‘100%’ height = ‘250px’ codec = ‘video/webm’</p>
<video width="100%" height="250px" controls><source src="  " type="video/webm"> Your browser does not support the webm tag.</video>
<p>or with args:</p>
<video width="100%" height="250px" controls><source src="  " type="video/mp4"> Your browser does not support the webm tag.</video>
<p>Add hexo-tag-html5 to your _config.yml file including all the other packages you’re using. (Once you include one, you will need to include them all, grab the list from you package.json)</p>
<p>Example: plugins: [hexo-tag-html5, hexo-deployer-git,<br>hexo-server, hexo-generator-index, hexo-generator-archive, hexo-generator-category, hexo-generator-json-content, hexo-generator-tag, hexo-renderer-ejs, hexo-renderer-marked, hexo-renderer-stylus, hexo-tag-bootstrap, hexo-tag-fontawesome, hexo-tag-leaflet]</p>
<p><a href="https://wohugb.gitbooks.io" target="_blank" rel="external">https://wohugb.gitbooks.io</a>     npm使用</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/doc/2017-09-16/Hexo使用笔记/" data-id="cj8x49dno0004msm1agr5qb6f" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>


</section>
            
                
<aside id="sidebar">
   
        
    <div class="widget-wrap">
        <h3 class="widget-title">最新文章</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/doc/2017-09-28/正则表达式30分钟入门教程/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/doc/2017-09-28/正则表达式30分钟入门教程/" class="title">正则表达式30分钟入门教程</a></p>
                            <p class="item-date"><time datetime="2017-09-28T07:42:33.000Z" itemprop="datePublished">2017-09-28</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/doc/2017-09-21/Markdown基本使用/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/doc/2017-09-21/Markdown基本使用/" class="title">Markdown基本使用</a></p>
                            <p class="item-date"><time datetime="2017-09-21T07:42:33.000Z" itemprop="datePublished">2017-09-21</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/doc/2017-09-20/开放式 ETL 系统的设计与实践/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/doc/2017-09-20/开放式 ETL 系统的设计与实践/" class="title">开放式 ETL 系统的设计与实践</a></p>
                            <p class="item-date"><time datetime="2017-09-20T07:42:33.000Z" itemprop="datePublished">2017-09-20</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/doc/2017-09-18/开源监控软件对比_zabbix/" class="thumbnail">
    
    
        <span style="background-image:url(/css/images/favicon.gif)" alt="开源监控软件对比_zabbix" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/doc/2017-09-18/开源监控软件对比_zabbix/" class="title">开源监控软件对比_zabbix</a></p>
                            <p class="item-date"><time datetime="2017-09-18T07:42:33.000Z" itemprop="datePublished">2017-09-18</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/doc/2017-09-16/Hexo使用笔记/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/doc/2017-09-16/Hexo使用笔记/" class="title">Hexo基础使用</a></p>
                            <p class="item-date"><time datetime="2017-09-16T07:42:33.000Z" itemprop="datePublished">2017-09-16</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
    
        
    <div class="widget-wrap">
        <h3 class="widget-title">归档</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a><span class="archive-list-count">5</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">标签</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/软文收集/">软文收集</a><span class="tag-list-count">3</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">标签云</h3>
        <div class="widget tagcloud">
            <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/软文收集/" style="font-size: 20px;">软文收集</a>
        </div>
    </div>

    
        
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">链接</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://hexo.io">Hexo</a>
                    </li>
                
            </ul>
        </div>
    </div>


    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>

            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2017 mingzi li<br>
            <!--Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>-->
        </div>
    </div>
</footer>
        


    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>